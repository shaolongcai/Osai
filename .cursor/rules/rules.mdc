---
alwaysApply: true
---

---
description: "Osai 專案開發規範"
alwaysApply: true
---

# 專案概述

Osai 是一個基於 Electron 的 AI 驅動智能搜索應用程式，使用 React + TypeScript + Vite 構建前端，Electron 構建桌面應用。

# 技術棧

## 前端技術
- **框架**: React 19.1.1
- **語言**: TypeScript 5.8.3
- **構建工具**: Vite 7.1.2
- **UI 框架**: Material-UI (MUI) 7.3.2
- **樣式**: Tailwind CSS 4.1.17
- **路由**: React Router DOM 7.9.4
- **狀態管理**: React Context API
- **國際化**: 自定義 i18n 實現
- **工具庫**: ahooks 3.9.6

## 後端技術
- **框架**: Electron 38.0.0
- **數據庫**: SQLite (better-sqlite3)
- **語言**: TypeScript
- **構建工具**: Vite + Electron Forge

## 開發工具
- **Linter**: ESLint 9.33.0
- **Style Linter**: Stylelint 16.9.0
- **Type Checking**: TypeScript strict mode (目前為 false，但建議逐步啟用)

# 命名規範

## 檔案命名
- 使用 **kebab-case**（短橫線分隔）
- 範例: `setting-item.tsx`, `global-context.ts`, `electron-api.d.ts`

## 變數與函數命名
- 使用 **camelCase**（駝峰式）
- 範例: `getConfig`, `isReadyAI`, `handleSearch`

## 類別與元件命名
- 使用 **PascalCase**（大寫開頭）
- 範例: `SettingItem`, `I18nProvider`, `ElectronAPI`

## 類型與介面命名
- 介面: **PascalCase**，建議使用 `I` 前綴（可選）
- 類型別名: **PascalCase**
- 範例: `Props`, `GpuInfo`, `BaseResponse<T>`

## 常數命名
- 使用 **UPPER_SNAKE_CASE**（全大寫加底線）
- 範例: `API_HOST`, `MAX_RETRY_COUNT`

# 專案結構

## 目錄組織

```
osai/
├── electron/              # Electron 主進程
│   ├── main.ts           # 主進程入口
│   ├── preload.ts        # 預載入腳本
│   ├── api/              # API 接口層
│   ├── core/             # 核心業務邏輯
│   ├── database/         # 資料庫操作
│   ├── sever/            # 服務層（AI、OCR 等）
│   ├── workers/          # Worker 執行緒
│   └── types/            # TypeScript 類型定義
├── frontend/             # React 前端
│   ├── src/
│   │   ├── components/   # React 元件
│   │   ├── pages/        # 頁面元件
│   │   ├── contexts/     # Context 提供者
│   │   ├── hooks/        # 自定義 Hooks
│   │   ├── types/        # TypeScript 類型
│   │   ├── utils/        # 工具函數
│   │   ├── i18n/         # 國際化資源
│   │   └── assets/       # 靜態資源
│   └── public/           # 公共資源
└── dist-electron/        # Electron 編譯輸出
```

## 元件組織原則
- 每個元件應該有自己的資料夾（如 `components/SettingItem/`）
- 元件資料夾內包含主檔案（`SettingItem.tsx`）和可選的 `index.ts`
- 相關類型定義應該放在元件的同一資料夾或 `types/` 目錄

# 程式碼規範

## TypeScript 規範

### 類型定義
- **禁止使用 `any` 類型**，必須明確指定類型
- 使用介面（`interface`）定義物件結構
- 使用類型別名（`type`）定義聯合類型、交叉類型等
- 使用泛型提高程式碼重用性

```typescript
// ✅ 正確
interface UserConfig {
  key: string;
  value: string | number | boolean;
}

// ❌ 錯誤
function processData(data: any) { }
```

### 型別定義檔案位置
- 全域類型定義放在 `frontend/src/types/` 或 `electron/types/`
- 元件特定類型可以放在元件資料夾內
- Electron API 類型定義在 `frontend/src/types/electron.d.ts`

### 函數註解
- **所有函數必須加上 JSDoc 註解**
- 註解應包含 `@description`、`@param`、`@returns` 等標籤

```typescript
/**
 * @description 獲取使用者配置
 * @param key 配置鍵名，可選
 * @returns 配置值或配置物件
 */
async function getConfig(key?: string): Promise<UserConfig | string> {
  // ...
}
```

## React 規範

### 元件定義
- 使用函數元件（Function Components）
- 使用 TypeScript 介面定義 Props
- 使用 `React.FC<Props>` 或直接定義函數並指定回傳類型

```typescript
// ✅ 推薦方式 1
interface Props {
  title: string;
  onAction?: () => void;
}

const SettingItem: React.FC<Props> = ({ title, onAction }) => {
  return <div>{title}</div>;
};

// ✅ 推薦方式 2
const SettingItem = ({ title, onAction }: Props): JSX.Element => {
  return <div>{title}</div>;
};
```

### Hooks 使用
- 優先使用 React Hooks 進行狀態管理
- 自定義 Hooks 放在 `frontend/src/hooks/` 目錄
- 使用 `ahooks` 提供的 Hooks（如 `useRequest`）處理異步操作

### Context 使用
- 使用 React Context API 進行狀態管理
- Context 定義在 `frontend/src/contexts/` 目錄
- 提供者元件使用 `Provider` 後綴命名

### 樣式規範
- **優先使用 Tailwind CSS 類別**
- Material-UI 元件使用 `sx` prop 進行樣式覆蓋
- 避免使用內聯樣式（`style` prop），除非必要
- 自定義樣式使用 CSS Modules 或 SCSS（如果需要的話）

```typescript
// ✅ 正確：使用 Tailwind
<div className="w-full p-4 border border-border">

// ✅ 正確：MUI 元件使用 sx
<Paper sx={{ padding: '16px' }}>

// ❌ 避免：內聯樣式
<div style={{ width: '100%', padding: '16px' }}>
```

## Electron 規範

### IPC 通訊
- 前端通過 `window.electronAPI` 呼叫 Electron API
- API 定義在 `electron/preload.ts` 中暴露
- 類型定義在 `frontend/src/types/electron.d.ts`

```typescript
// ✅ 正確：使用 typed API
const config = await window.electronAPI.getConfig('ai_provider');

// ❌ 錯誤：直接使用 ipcRenderer（不安全）
const { ipcRenderer } = window.require('electron');
```

### 主進程組織
- API 處理放在 `electron/api/` 目錄
- 核心業務邏輯放在 `electron/core/` 目錄
- 資料庫操作放在 `electron/database/` 目錄
- 服務層放在 `electron/sever/` 目錄（注意：此處拼寫為 sever，不是 server）

### Worker 執行緒
- 耗時操作使用 Worker 執行緒
- Worker 檔案放在 `electron/workers/` 目錄
- Worker 檔案使用 `.worker.ts` 後綴

## API 與資料處理

### Electron IPC API
- **統一通過 `window.electronAPI` 進行通訊**
- 不允許在前端直接使用 `fetch` 呼叫 HTTP API（除非是外部服務）
- 所有與 Electron 主進程的資料交換都通過 IPC

```typescript
// ✅ 正確
const result = await window.electronAPI.searchFiles(query);

// ❌ 錯誤（在 Electron 環境中）
const result = await fetch('/api/search', { ... });
```

### 錯誤處理
- 使用 try-catch 處理異步錯誤
- API 回傳使用統一的響應格式（如 `BaseResponse<T>`）
- 錯誤訊息使用 i18n 進行國際化

## 國際化 (i18n)

### 語言資源
- 語言檔案放在 `frontend/src/i18n/locales/` 目錄
- 檔案命名格式: `{language}.json`（如 `zh-TW.json`, `en.json`）
- 使用巢狀結構組織翻譯鍵值

### 使用方式
- 使用 `useTranslation` Hook 獲取翻譯函數
- 所有使用者可見的文字都必須使用 i18n

```typescript
import { useTranslation } from '@/contexts/I18nContext';

const { t } = useTranslation();

// ✅ 正確
<Typography>{t('app.settings.title')}</Typography>

// ❌ 錯誤
<Typography>設定</Typography>
```

## 檔案組織

### 匯入順序
1. React 相關匯入
2. 第三方庫匯入（MUI、ahooks 等）
3. 內部元件匯入（使用 `@/` 別名）
4. 類型匯入
5. 樣式匯入

```typescript
import { useState, useEffect } from 'react';
import { Paper, Stack, Typography } from '@mui/material';
import { useRequest } from 'ahooks';
import { useTranslation } from '@/contexts/I18nContext';
import { SettingItem } from '@/components';
import type { UserConfig } from '@/types/electron';
import './styles.css';
```

### 路徑別名
- 使用 `@/` 別名指向 `frontend/src/`
- 配置在 `frontend/vite.config.ts` 和 `frontend/tsconfig.json` 中

# 程式碼品質

## SOLID 原則
- **S**ingle Responsibility: 單一職責原則
- **O**pen/Closed: 開閉原則
- **L**iskov Substitution: 里氏替換原則
- **I**nterface Segregation: 介面隔離原則
- **D**ependency Inversion: 依賴反轉原則

## 程式碼檢查

### ESLint
- 使用 ESLint 9.33.0 進行程式碼檢查
- 配置檔案: `frontend/eslint.config.js`
- 執行檢查: `npm run lint`

### Stylelint
- 使用 Stylelint 16.9.0 進行樣式檢查
- 執行檢查: `npm run lint:style`

### 自動修復
- 每次提交前執行 `npm run lint` 和 `npm run lint:style`
- 自動修復可修復的問題

## 測試
- 目前專案尚未配置測試框架
- 未來應考慮加入單元測試和整合測試

# 開發工作流程

## 開發環境啟動
```bash
# 前端開發伺服器
cd frontend && npm run dev

# Electron 開發模式
npm run electron:dev
```

## 構建
```bash
# Windows
npm run build:win

# 或使用腳本
./run-build.bat  # Windows
./run-build.sh   # Linux/macOS
```

## 提交前檢查清單
- [ ] 執行 `npm run lint` 確保沒有 ESLint 錯誤
- [ ] 執行 `npm run lint:style` 確保沒有 Stylelint 錯誤
- [ ] 確認所有 TypeScript 類型正確，沒有 `any` 類型
- [ ] 確認所有函數都有 JSDoc 註解
- [ ] 確認所有使用者可見文字都使用 i18n
- [ ] 確認程式碼符合命名規範

# 特殊注意事項

## Electron 環境檢測
- 在需要檢測 Electron 環境時，使用以下方式：
```typescript
const isElectron = typeof window !== 'undefined' && (window as any).electronAPI;
```

## 視窗管理
- 使用 `WindowManager` 管理多個視窗
- 視窗類型包括: `mainWindow`, `searchWindow`, `settingsWindow`

## 資料庫操作
- 使用 `better-sqlite3` 進行同步資料庫操作
- Repository 模式組織資料庫操作
- Schema 定義在 `electron/database/schema.ts`

## AI 服務整合
- AI 服務通過 Ollama 整合
- 配置保存在使用者配置中
- 向量化服務用於語義搜索

## 檔案索引
- 使用 Worker 執行緒進行檔案索引，避免阻塞主執行緒
- 支援多種檔案格式（PDF、DOCX、XLSX、圖片等）
- OCR 服務用於圖片文字提取

# 版本控制

## Git 提交訊息
- 使用繁體中文或英文
- 提交訊息應該清楚描述變更內容
- 建議格式: `[類型] 描述`

範例:
- `[feat] 新增 AI 標記功能`
- `[fix] 修復搜索結果排序問題`
- `[refactor] 重構設定頁面元件`

# VSCode 擴充功能建議

專案應該配置以下 VSCode 擴充功能：
- **i18n Ally**: 國際化支援
- **vscode-stylelint**: Stylelint 整合
- **Tailwind CSS IntelliSense**: Tailwind CSS 自動完成

# 文件規範

## Markdown 文件
- 所有文件使用 Markdown 格式
- 文件應該放在專案根目錄或對應目錄的 README.md

## 程式碼註解
- 複雜邏輯必須加上註解說明
- 使用繁體中文註解
- JSDoc 註解使用繁體中文或英文

# 語言規範

- **所有回應和註解使用繁體中文**
- 程式碼中的字串使用 i18n，不直接寫死文字
- 變數和函數名稱使用英文（遵循命名規範）
- 提交訊息可以使用繁體中文或英文

