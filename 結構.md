# Osai - AI 搜索應用項目結構文檔

## 項目概述

**項目名稱**: Osai - AI 驅動的智能搜索應用  
**技術棧**: Electron + React + TypeScript + Material-UI + SQLite + LanceDB  
**主要功能**: 
- AI 驅動的文件內容搜索
- OCR 圖像文字識別
- 多語言支持（8種語言）
- 本地文件索引和向量化
- 實時搜索結果展示

---

## 項目結構總覽

```
ai-search-main/
├── electron/                    # Electron 主程序代碼
├── frontend/                    # React 前端應用
├── dist-electron/               # 編譯後的 Electron 代碼
├── updatePack/                  # 更新包相關
├── build/                       # 構建配置
├── package.json                 # 主項目配置
├── readme.md                    # 項目說明
├── vite.main.config.js          # Vite 主進程構建配置
├── vite.preload.config.js       # Vite 預加載腳本構建配置
├── vite.renderer.config.js      # Vite 渲染進程構建配置
├── run-build.bat/.sh            # 構建腳本
├── run-dev.bat/.sh              # 開發環境啟動腳本
├── create-mac-icons.sh          # macOS 圖標生成腳本
├── dev-app-update.yml           # 開發環境自動更新配置
├── chi_sim.traineddata          # 簡體中文 OCR 訓練數據
├── chi_tra.traineddata          # 繁體中文 OCR 訓練數據
├── eng.traineddata              # 英文 OCR 訓練數據
├── .gitignore                   # Git 忽略文件配置
└── .npmrc                       # npm 配置文件
```

---

## 詳細目錄結構

### 根目錄配置文件
- **`package.json`** - 主項目配置，包含 Electron 構建配置、依賴管理和構建腳本
- **`.gitignore`** - Git 忽略文件配置
- **`.npmrc`** - npm 配置文件
- **`readme.md`** - 項目說明和打包注意事項
- **`vite.main.config.js`** - Vite 主進程構建配置
- **`vite.preload.config.js`** - Vite 預加載腳本構建配置
- **`vite.renderer.config.js`** - Vite 渲染進程構建配置

### 構建腳本
- **`run-build.bat`** / **`run-build.sh`** - Windows/Linux 構建腳本
- **`run-dev.bat`** / **`run-dev.sh`** - Windows/Linux 開發環境啟動腳本
- **`create-mac-icons.sh`** - macOS 圖標生成腳本

### 更新和部署
- **`dev-app-update.yml`** - 開發環境自動更新配置
- **`updatePack/`** - 更新包相關文件
  ```
  updatePack/
  ├── latest.yml                 # Windows 更新配置
  ├── latest-x64-mac.yml         # macOS x64 更新配置
  ├── latest-arm64-mac.yml       # macOS ARM64 更新配置
  ├── quick-generate.py          # 更新包生成腳本
  └── quick-generate-mac.py      # macOS 更新包生成腳本
  ```

### 資源文件
- **`build/entitlements.mac.plist`** - macOS 應用權限配置
- **OCR 訓練數據文件**:
  - `chi_sim.traineddata` - 簡體中文
  - `chi_tra.traineddata` - 繁體中文
  - `eng.traineddata` - 英文

---

## electron/ 目錄（主進程）

```
electron/
├── main.ts                      # Electron 主進程入口
├── preload.ts                   # 預加載腳本，API 橋接
├── tsconfig.json                # TypeScript 配置
├── api/                         # API 接口層
│   ├── file.ts                  # 文件操作 API
│   ├── system.ts                # 系統相關 API
│   └── update.ts                # 應用更新 API
├── core/                        # 核心業務邏輯
│   ├── appState.ts              # 應用狀態管理
│   ├── documentSever.ts         # 文檔服務器
│   ├── downloader.ts            # 文件下載服務
│   ├── imageSever.ts            # 圖像服務器
│   ├── indexFiles.ts            # 文件索引服務
│   ├── indexer.worker.ts        # 索引工作線程（主要）
│   ├── indexer2.worker.ts       # 索引工作線程（備用）
│   ├── logger.ts                # 日誌系統
│   ├── model.ts                 # AI 模型管理
│   ├── ollama.ts                # Ollama AI 服務集成
│   ├── pathConfigs.ts           # 路徑配置管理
│   ├── search.ts                # 搜索引擎核心邏輯
│   ├── system.ts                # 系統信息檢測
│   ├── updateService.ts         # 自動更新服務
│   └── vectorization.ts         # 向量化服務
├── database/                    # 數據庫操作
│   ├── lanceDb.ts               # LanceDB 向量數據庫
│   └── sqlite.ts                # SQLite 關係型數據庫
├── workers/                     # 工作線程
│   ├── ai.worker.ts             # AI 處理工作線程
│   └── imageProcessor.worker.ts # 圖像處理工作線程
├── types/                       # 類型定義
│   ├── ai.d.ts                  # AI 相關類型
│   ├── api.d.ts                 # API 接口類型
│   ├── database.d.ts            # 數據庫類型
│   ├── search.d.ts              # 搜索相關類型
│   └── system.d.ts              # 系統相關類型
├── resources/                   # 資源文件
│   ├── app-update.yml           # 應用更新配置
│   ├── assets/                  # 靜態資源文件
│   ├── elevate.exe              # Windows 權限提升工具
│   ├── ollama/                  # Ollama AI 服務相關文件
│   ├── pythonScript/            # Python 腳本文件
│   └── traineddata/             # OCR 訓練數據
├── units/                       # 工具類
│   └── enum.ts                  # 枚舉定義
└── data/                        # 數據文件
    └── prompt.ts                # AI 提示詞模板
```

### 核心文件說明
- **`main.ts`** - Electron 主進程入口，負責創建窗口、初始化服務
- **`preload.ts`** - 預加載腳本，提供安全的 API 橋接，暴露 electronAPI 給渲染進程

### API 接口層 (`api/`)
- **`file.ts`** - 文件操作 API（搜索、打開目錄等）
- **`system.ts`** - 系統相關 API（配置管理、GPU 檢測、AI 服務安裝）
- **`update.ts`** - 應用更新 API（檢查更新、下載更新）

### 核心業務邏輯 (`core/`)
- **`appState.ts`** - 應用狀態管理
- **`documentSever.ts`** - 文檔服務器，處理文檔預覽
- **`downloader.ts`** - 文件下載服務
- **`imageSever.ts`** - 圖像服務器，處理圖像預覽
- **`indexFiles.ts`** - 文件索引服務，負責文件掃描和索引
- **`indexer.worker.ts`** - 索引工作線程（主要）
- **`indexer2.worker.ts`** - 索引工作線程（備用）
- **`logger.ts`** - 日誌系統
- **`model.ts`** - AI 模型管理
- **`ollama.ts`** - Ollama AI 服務集成
- **`pathConfigs.ts`** - 路徑配置管理
- **`search.ts`** - 搜索引擎核心邏輯
- **`system.ts`** - 系統信息檢測（GPU、內存等）
- **`updateService.ts`** - 自動更新服務
- **`vectorization.ts`** - 向量化服務，將文本轉換為向量

### 數據庫操作 (`database/`)
- **`lanceDb.ts`** - LanceDB 向量數據庫操作
- **`sqlite.ts`** - SQLite 關係型數據庫操作

### 工作線程 (`workers/`)
- **`ai.worker.ts`** - AI 處理工作線程
- **`imageProcessor.worker.ts`** - 圖像處理工作線程

### 類型定義 (`types/`)
- **`ai.d.ts`** - AI 相關類型定義
- **`api.d.ts`** - API 接口類型定義
- **`database.d.ts`** - 數據庫類型定義
- **`search.d.ts`** - 搜索相關類型定義
- **`system.d.ts`** - 系統相關類型定義

### 資源文件 (`resources/`)
- **`app-update.yml`** - 應用更新配置
- **`assets/`** - 靜態資源文件
- **`elevate.exe`** - Windows 權限提升工具
- **`ollama/`** - Ollama AI 服務相關文件
- **`pythonScript/`** - Python 腳本文件
- **`traineddata/`** - OCR 訓練數據

### 工具類 (`units/`)
- **`enum.ts`** - 枚舉定義

### 數據文件 (`data/`)
- **`prompt.ts`** - AI 提示詞模板

---

## frontend/ 目錄（渲染進程）

```
frontend/
├── package.json                 # 前端項目依賴和腳本配置
├── vite.config.ts               # Vite 構建配置
├── tsconfig.json                # TypeScript 配置
├── eslint.config.js             # ESLint 代碼規範配置
├── index.html                   # HTML 入口文件
├── public/                      # 公共資源
│   ├── locales/                 # 多語言翻譯文件
│   │   ├── zh-CN.json           # 簡體中文
│   │   ├── zh-TW.json           # 繁體中文
│   │   ├── en-US.json           # 英文
│   │   ├── ja-JP.json           # 日文
│   │   ├── ko-KR.json           # 韓文
│   │   ├── fr-FR.json           # 法文
│   │   ├── de-DE.json           # 德文
│   │   └── vi-VN.json           # 越南文
│   ├── logo.svg                 # 應用圖標
│   └── vite.svg                 # Vite 圖標
├── src/                         # 源代碼
│   ├── main.tsx                 # React 應用入口
│   ├── App.tsx                  # 主應用組件
│   ├── App.css                  # 應用樣式
│   ├── index.css                # 全局樣式
│   ├── theme.ts                 # Material-UI 主題配置
│   ├── global.d.ts              # 全局類型定義
│   ├── vite-env.d.ts            # Vite 環境類型定義
│   ├── pages/                   # 頁面組件
│   │   ├── home/                # 主頁面
│   │   │   ├── home.tsx         # 主頁面組件
│   │   │   └── home.module.scss # 主頁面樣式
│   │   └── preload/             # 預加載頁面
│   │       ├── Preload.tsx      # 預加載組件
│   │       └── Preload.module.scss # 預加載樣式
│   ├── components/              # 組件庫
│   │   ├── AIMarkDialog/        # AI 標記對話框
│   │   ├── Contact/             # 聯繫方式組件
│   │   ├── Dialog/              # 通用對話框組件
│   │   ├── InfoCard/            # 信息卡片組件
│   │   ├── LanguageSwitcher/    # 語言切換器
│   │   ├── ReportProtocol/      # 報告協議組件
│   │   ├── Search/              # 搜索組件
│   │   ├── Setting/             # 設置組件
│   │   ├── SettingItem/         # 設置項組件
│   │   ├── TableRelust/         # 結果表格組件
│   │   ├── UpdateTipsDialog/    # 更新提示對話框
│   │   └── index.ts             # 組件統一導出
│   ├── contexts/                # 上下文管理
│   │   └── I18nContext.tsx      # 國際化上下文
│   ├── config/                  # 配置文件
│   │   └── languages.ts         # 語言配置
│   ├── types/                   # 類型定義
│   │   ├── i18n.ts              # 國際化類型
│   │   ├── electron.ts          # Electron API 類型
│   │   └── system.ts            # 系統相關類型
│   ├── assets/                  # 靜態資源
│   │   ├── images/              # 圖片資源
│   │   │   ├── weChat.png       # 微信二維碼
│   │   │   └── flags/           # 國旗 SVG 文件
│   │   └── icons/               # 圖標文件
│   ├── utils/                   # 工具函數
│   └── context/                 # 舊版上下文（兼容）
│       └── globalContext.tsx    # 全局狀態上下文
└── dist/                        # 構建輸出
    ├── assets/                  # 編譯後的資源
    ├── index.html               # 編譯後的 HTML
    └── locales/                 # 編譯後的語言文件
```

### 核心文件說明
- **`main.tsx`** - React 應用入口
- **`App.tsx`** - 主應用組件，包含路由和全局狀態
- **`App.css`** / **`index.css`** - 全局樣式
- **`theme.ts`** - Material-UI 主題配置
- **`global.d.ts`** / **`vite-env.d.ts`** - 全局類型定義

### 組件功能說明

#### 頁面組件 (`pages/`)
- **`home/home.tsx`** - 主頁面組件，包含搜索界面和結果展示
- **`preload/Preload.tsx`** - 應用啟動時的加載頁面

#### 核心組件 (`components/`)
- **`AIMarkDialog/`** - AI 文件標記功能對話框
- **`Contact/`** - 顯示聯繫信息和微信二維碼
- **`Dialog/`** - 可復用的通用對話框組件
- **`InfoCard/`** - 顯示系統信息的卡片組件
- **`LanguageSwitcher/`** - 多語言切換組件（支持8種語言）
- **`ReportProtocol/`** - 錯誤報告和協議展示組件
- **`Search/`** - 搜索輸入和邏輯處理組件
- **`Setting/`** - 應用設置界面組件
- **`SettingItem/`** - 單個設置項組件
- **`TableRelust/`** - 搜索結果表格展示組件
- **`UpdateTipsDialog/`** - 應用更新提示界面

#### 上下文和配置
- **`contexts/I18nContext.tsx`** - 國際化上下文，管理多語言狀態
- **`config/languages.ts`** - 語言配置，定義支持的語言和相關配置

#### 類型定義
- **`types/i18n.ts`** - 國際化相關類型定義
- **`types/electron.ts`** - Electron API 類型定義
- **`types/system.ts`** - 系統相關類型定義
- 各種工具函數和輔助方法

#### 靜態資源 (`assets/`)
- **`images/`** - 圖片資源
  - `weChat.png` - 微信二維碼
  - 各國旗幟 SVG 文件
- **`icons/`** - 圖標文件

#### 舊版上下文 (`context/`)
- **`globalContext.tsx`** - 全局狀態上下文（舊版本）

### 公共資源 (`public/`)
- **`locales/`** - 多語言翻譯文件
  - `zh-CN.json` - 簡體中文
  - `zh-TW.json` - 繁體中文
  - `en-US.json` - 英文
  - `ja-JP.json` - 日文
  - `ko-KR.json` - 韓文
  - `fr-FR.json` - 法文
  - `de-DE.json` - 德文
  - `vi-VN.json` - 越南文
- **`logo.svg`** / **`vite.svg`** - 應用圖標

### 構建輸出 (`dist/`)
- 編譯後的前端資源文件

---

## 構建和部署

### 編譯輸出 (`dist-electron/`)
編譯後的 Electron 主進程代碼，結構與 `electron/` 目錄相同：
- **`main.js`** - 編譯後的主進程入口
- **`preload.js`** - 編譯後的預加載腳本
- **`api/`** - 編譯後的 API 接口
- **`core/`** - 編譯後的核心業務邏輯
- **`database/`** - 編譯後的數據庫操作
- **`workers/`** - 編譯後的工作線程
- **`units/`** - 編譯後的工具類
- **`data/`** - 編譯後的數據文件

### 構建流程
1. **開發環境**: `npm run electron:dev` - 同時啟動前端開發服務器和 Electron
2. **前端構建**: `cd frontend && npm run build` - 構建 React 應用
3. **Electron 構建**: `npm run build:win` - 構建 Windows 可執行文件
4. **打包**: `npm run package` - 創建應用安裝包

### 開發工具
- **Vite** - 快速的前端構建工具
- **Electron Forge** - Electron 應用打包和分發
- **TypeScript** - 類型安全的 JavaScript
- **ESLint** - 代碼質量檢查

---

## 技術架構

### 進程通信
- **主進程 ↔ 渲染進程**: 通過 `preload.ts` 中的 `electronAPI` 進行安全通信
- **工作線程**: 使用 Web Workers 處理耗時任務（索引、AI 處理）

### 數據存儲
- **SQLite**: 存儲文件元數據、配置信息
- **LanceDB**: 存儲文本向量，支持相似性搜索

### AI 集成
- **Ollama**: 本地 AI 模型服務
- **向量化**: 將文本轉換為向量進行語義搜索
- **OCR**: Tesseract 引擎進行圖像文字識別

### 國際化
- **React Context**: 管理語言狀態
- **JSON 翻譯文件**: 支持 8 種語言
- **動態語言切換**: 實時切換界面語言

這個項目是一個功能完整的桌面應用，結合了現代前端技術和 AI 能力，為用戶提供智能的文件搜索體驗。